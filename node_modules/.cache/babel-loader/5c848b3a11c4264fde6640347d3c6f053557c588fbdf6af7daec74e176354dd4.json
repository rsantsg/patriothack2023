{"ast":null,"code":"let barycenter = require(\"./barycenter\");\nlet resolveConflicts = require(\"./resolve-conflicts\");\nlet sort = require(\"./sort\");\nmodule.exports = sortSubgraph;\nfunction sortSubgraph(g, v, cg, biasRight) {\n  let movable = g.children(v);\n  let node = g.node(v);\n  let bl = node ? node.borderLeft : undefined;\n  let br = node ? node.borderRight : undefined;\n  let subgraphs = {};\n  if (bl) {\n    movable = movable.filter(w => w !== bl && w !== br);\n  }\n  let barycenters = barycenter(g, movable);\n  barycenters.forEach(entry => {\n    if (g.children(entry.v).length) {\n      let subgraphResult = sortSubgraph(g, entry.v, cg, biasRight);\n      subgraphs[entry.v] = subgraphResult;\n      if (subgraphResult.hasOwnProperty(\"barycenter\")) {\n        mergeBarycenters(entry, subgraphResult);\n      }\n    }\n  });\n  let entries = resolveConflicts(barycenters, cg);\n  expandSubgraphs(entries, subgraphs);\n  let result = sort(entries, biasRight);\n  if (bl) {\n    result.vs = [bl, result.vs, br].flat(true);\n    if (g.predecessors(bl).length) {\n      let blPred = g.node(g.predecessors(bl)[0]),\n        brPred = g.node(g.predecessors(br)[0]);\n      if (!result.hasOwnProperty(\"barycenter\")) {\n        result.barycenter = 0;\n        result.weight = 0;\n      }\n      result.barycenter = (result.barycenter * result.weight + blPred.order + brPred.order) / (result.weight + 2);\n      result.weight += 2;\n    }\n  }\n  return result;\n}\nfunction expandSubgraphs(entries, subgraphs) {\n  entries.forEach(entry => {\n    entry.vs = entry.vs.flatMap(v => {\n      if (subgraphs[v]) {\n        return subgraphs[v].vs;\n      }\n      return v;\n    });\n  });\n}\nfunction mergeBarycenters(target, other) {\n  if (target.barycenter !== undefined) {\n    target.barycenter = (target.barycenter * target.weight + other.barycenter * other.weight) / (target.weight + other.weight);\n    target.weight += other.weight;\n  } else {\n    target.barycenter = other.barycenter;\n    target.weight = other.weight;\n  }\n}","map":{"version":3,"names":["barycenter","require","resolveConflicts","sort","module","exports","sortSubgraph","g","v","cg","biasRight","movable","children","node","bl","borderLeft","undefined","br","borderRight","subgraphs","filter","w","barycenters","forEach","entry","length","subgraphResult","hasOwnProperty","mergeBarycenters","entries","expandSubgraphs","result","vs","flat","predecessors","blPred","brPred","weight","order","flatMap","target","other"],"sources":["/Users/ron/Documents/developer/patriothack/node_modules/@dagrejs/dagre/lib/order/sort-subgraph.js"],"sourcesContent":["let barycenter = require(\"./barycenter\");\nlet resolveConflicts = require(\"./resolve-conflicts\");\nlet sort = require(\"./sort\");\n\nmodule.exports = sortSubgraph;\n\nfunction sortSubgraph(g, v, cg, biasRight) {\n  let movable = g.children(v);\n  let node = g.node(v);\n  let bl = node ? node.borderLeft : undefined;\n  let br = node ? node.borderRight: undefined;\n  let subgraphs = {};\n\n  if (bl) {\n    movable = movable.filter(w => w !== bl && w !== br);\n  }\n\n  let barycenters = barycenter(g, movable);\n  barycenters.forEach(entry => {\n    if (g.children(entry.v).length) {\n      let subgraphResult = sortSubgraph(g, entry.v, cg, biasRight);\n      subgraphs[entry.v] = subgraphResult;\n      if (subgraphResult.hasOwnProperty(\"barycenter\")) {\n        mergeBarycenters(entry, subgraphResult);\n      }\n    }\n  });\n\n  let entries = resolveConflicts(barycenters, cg);\n  expandSubgraphs(entries, subgraphs);\n\n  let result = sort(entries, biasRight);\n\n  if (bl) {\n    result.vs = [bl, result.vs, br].flat(true);\n    if (g.predecessors(bl).length) {\n      let blPred = g.node(g.predecessors(bl)[0]),\n        brPred = g.node(g.predecessors(br)[0]);\n      if (!result.hasOwnProperty(\"barycenter\")) {\n        result.barycenter = 0;\n        result.weight = 0;\n      }\n      result.barycenter = (result.barycenter * result.weight +\n                           blPred.order + brPred.order) / (result.weight + 2);\n      result.weight += 2;\n    }\n  }\n\n  return result;\n}\n\nfunction expandSubgraphs(entries, subgraphs) {\n  entries.forEach(entry => {\n    entry.vs = entry.vs.flatMap(v => {\n      if (subgraphs[v]) {\n        return subgraphs[v].vs;\n      }\n      return v;\n    });\n  });\n}\n\nfunction mergeBarycenters(target, other) {\n  if (target.barycenter !== undefined) {\n    target.barycenter = (target.barycenter * target.weight +\n                         other.barycenter * other.weight) /\n                        (target.weight + other.weight);\n    target.weight += other.weight;\n  } else {\n    target.barycenter = other.barycenter;\n    target.weight = other.weight;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}